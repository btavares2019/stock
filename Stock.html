<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controle de Estoque com Login</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
  }
  #loginForm {
    max-width: 320px;
    margin: 80px auto;
    padding: 20px;
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    text-align: center;
  }
  #loginForm input, #loginForm button {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    font-size: 16px;
    box-sizing: border-box;
  }
  #msgErro {
    color: red;
    display: none;
    margin-top: -8px;
  }
  #mainApp {
    display: none;
    max-width: 900px;
    margin: 20px auto;
    background: white;
    padding: 20px;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 20px;
  }
  header img {
    height: 60px;
  }
  h1 {
    margin: 0;
  }
  #searchInput {
    margin-bottom: 10px;
    padding: 8px;
    width: 300px;
    font-size: 16px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  table, th, td {
    border: 1px solid #ccc;
  }
  th, td {
    padding: 8px;
    text-align: left;
  }
  .btn {
    padding: 6px 10px;
    cursor: pointer;
    border: none;
    border-radius: 3px;
  }
  .btn-remove {
    background-color: #e74c3c;
    color: white;
  }
  .btn-export {
    background-color: #3498db;
    color: white;
    margin-top: 10px;
  }
  #addRowBtn {
    margin-top: 10px;
    background-color: #2ecc71;
    color: white;
  }
  input[type=text], input[type=number] {
    width: 90%;
    padding: 6px;
    box-sizing: border-box;
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginForm">
  <h2>Login</h2>
  <input type="text" id="username" placeholder="Usuário" autocomplete="username" />
  <input type="password" id="password" placeholder="Senha" autocomplete="current-password" />
  <button id="btnLogin">Entrar</button>
  <p id="msgErro">Usuário ou senha incorretos!</p>
</div>

<!-- APP PRINCIPAL -->
<div id="mainApp">
  <header>
    <img src="https://inovar-mais.com/wp-content/uploads/2020/06/cropped-Logo-InovarMais-01.png" alt="Logo Inovar Mais" />
    <h1>Controle de Estoque</h1>
  </header>

  <input type="text" id="searchInput" placeholder="Buscar produto ou referência..." />

  <table id="dataTable">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Referência</th>
        <th>Data Última Alteração</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas dinâmicas aqui -->
    </tbody>
  </table>

  <button class="btn" id="addRowBtn">Adicionar Linha</button>
  <button class="btn btn-export" id="exportBtn">Exportar para Excel</button>
</div>

<script>
  // LOGIN
  const btnLogin = document.getElementById('btnLogin');
  const loginForm = document.getElementById('loginForm');
  const mainApp = document.getElementById('mainApp');
  const msgErro = document.getElementById('msgErro');

  btnLogin.addEventListener('click', () => {
    const user = document.getElementById('username').value.trim();
    const pass = document.getElementById('password').value.trim();

    if (user === 'admin' && pass === '1234') {
      loginForm.style.display = 'none';
      mainApp.style.display = 'block';
      msgErro.style.display = 'none';
    } else {
      msgErro.style.display = 'block';
    }
  });

  // Enter para login
  document.getElementById('password').addEventListener('keyup', e => {
    if (e.key === 'Enter') btnLogin.click();
  });

  // ELEMENTOS
  const tableBody = document.querySelector('#dataTable tbody');
  const addRowBtn = document.getElementById('addRowBtn');
  const searchInput = document.getElementById('searchInput');
  const exportBtn = document.getElementById('exportBtn');

  // FUNÇÃO para criar uma linha editável nova
  function criarLinha(produto='', quantidade='', referencia='', data='') {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td><input type="text" class="input-produto" value="${produto}" /></td>
      <td><input type="number" class="input-quantidade" value="${quantidade}" min="0" /></td>
      <td><input type="text" class="input-referencia" value="${referencia}" /></td>
      <td class="data-alteracao">${data}</td>
      <td><button class="btn btn-remove">Remover</button></td>
    `;

    // Atualiza data ao editar qualquer campo (produto, quantidade, referência)
    const inputs = tr.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('input', () => {
        const agora = new Date();
        tr.querySelector('.data-alteracao').textContent = agora.toLocaleString();
      });
    });

    // Evento remover linha
    tr.querySelector('.btn-remove').addEventListener('click', () => {
      tr.remove();
    });

    return tr;
  }

  // Adiciona linha nova
  addRowBtn.addEventListener('click', () => {
    const novaLinha = criarLinha('', '', '', new Date().toLocaleString());
    tableBody.appendChild(novaLinha);
  });

  // Busca simples (filtra linhas que contenham texto em produto ou referência)
  searchInput.addEventListener('input', () => {
    const filtro = searchInput.value.toLowerCase();

    [...tableBody.rows].forEach(row => {
      const produto = row.querySelector('.input-produto').value.toLowerCase();
      const referencia = row.querySelector('.input-referencia').value.toLowerCase();
      if (produto.includes(filtro) || referencia.includes(filtro)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });

  // Exportar para Excel (gera arquivo CSV)
  exportBtn.addEventListener('click', () => {
    let csvContent = 'Produto,Quantidade,Referencia,Data Última Alteração\n';
    [...tableBody.rows].forEach(row => {
      if(row.style.display === 'none') return; // Pula linhas filtradas

      const produto = row.querySelector('.input-produto').value.replace(/,/g, '');
      const quantidade = row.querySelector('.input-quantidade').value;
      const referencia = row.querySelector('.input-referencia').value.replace(/,/g, '');
      const dataAlt = row.querySelector('.data-alteracao').textContent;

      csvContent += `${produto},${quantidade},${referencia},${dataAlt}\n`;
    });

    const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'estoque.csv';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });
</script>

</body>
</html>
