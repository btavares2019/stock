<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gestão de Estoque</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #333;
    margin: 0; padding: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding-top: 40px;
  }
  #container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
    width: 900px;
    max-width: 95vw;
    padding: 30px 40px;
  }
  h2 {
    margin-top: 0;
    color: #4a3fbd;
    text-align: center;
  }
  input[type=text], input[type=number], input[type=password] {
    width: 100%;
    padding: 8px 10px;
    margin-top: 4px;
    margin-bottom: 12px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    font-size: 16px;
    transition: border-color 0.3s;
  }
  input[type=text]:focus, input[type=number]:focus, input[type=password]:focus {
    border-color: #764ba2;
    outline: none;
  }
  button {
    background: #764ba2;
    color: white;
    border: none;
    padding: 10px 18px;
    margin: 6px 4px;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 3px 8px rgb(118 75 162 / 0.5);
    transition: background-color 0.25s;
  }
  button:hover {
    background: #5b378a;
  }
  #loginForm, #app {
    max-width: 100%;
  }
  #app {
    display: none;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
    font-size: 15px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #764ba2;
    color: white;
  }
  #errorMsg {
    color: red;
    margin-top: -8px;
    margin-bottom: 12px;
    font-weight: 600;
  }
  .flex-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .flex-col {
    flex: 1;
    min-width: 120px;
  }
</style>
</head>
<body>

<div id="container">

  <!-- LOGIN -->
  <div id="loginForm">
    <h2>Login</h2>
    <label for="username">Usuário:</label>
    <input type="text" id="username" placeholder="Digite seu usuário" />
    <label for="password">Senha:</label>
    <input type="password" id="password" placeholder="Digite sua senha" />
    <button onclick="login()">Entrar</button>
    <p id="msgErro" style="color: red; display:none; font-weight:600; margin-top: 12px;">Usuário ou senha incorretos.</p>
  </div>

  <!-- APP -->
  <div id="app">
    <h2>Controle de Estoque</h2>
    <button onclick="logout()" style="float:right; background:#cc3366;">Logout</button>

    <div class="flex-row" style="margin-top: 30px;">
      <div class="flex-col">
        <label>Produto</label>
        <input type="text" id="produto" placeholder="Nome do produto" />
      </div>
      <div class="flex-col">
        <label>Quantidade</label>
        <input type="number" id="quantidade" min="0" placeholder="Quantidade" />
      </div>
      <div class="flex-col">
        <label>Referência</label>
        <input type="text" id="referencia" placeholder="Referência" />
      </div>
      <div class="flex-col">
        <label>Data (YYYY-MM-DD)</label>
        <input type="text" id="data" placeholder="2025-05-27" />
      </div>
      <div class="flex-col">
        <label>Quem fez a alteração <span style="color:red">*</span></label>
        <input type="text" id="alterador" placeholder="Responsável" />
      </div>
    </div>
    <p id="errorMsg" style="display:none;"></p>
    <button onclick="addRow()">Adicionar Produto</button>

    <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Procurar produto..." style="margin-left: 20px; padding:8px; font-size:15px; width: 250px; border-radius: 6px; border:1.5px solid #ccc;" />

    <table id="estoqueTable">
      <thead>
        <tr>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Referência</th>
          <th>Data</th>
          <th>Quem fez a alteração</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <!-- Linhas adicionadas dinamicamente -->
      </tbody>
    </table>

    <div style="margin-top: 15px;">
      <button onclick="saveTable()" title="Salvar dados em arquivo JSON">Salvar Dados</button>
      <input type="file" id="loadFile" accept=".json" />
      <button onclick="loadTable()">Carregar Dados</button>
      <button onclick="exportToExcel()">Exportar Excel</button>
    </div>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  // Login fixo
  const USER = 'admin';
  const PASS = '1234';

  const loginForm = document.getElementById('loginForm');
  const app = document.getElementById('app');
  const msgErro = document.getElementById('msgErro');
  const errorMsg = document.getElementById('errorMsg');

  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    if (username === USER && password === PASS) {
      loginForm.style.display = 'none';
      app.style.display = 'block';
      msgErro.style.display = 'none';
      // Limpar campos
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
    } else {
      msgErro.style.display = 'block';
    }
  }

  function logout() {
    app.style.display = 'none';
    loginForm.style.display = 'block';
  }

  function addRow() {
    const produto = document.getElementById('produto').value.trim();
    const quantidade = document.getElementById('quantidade').value.trim();
    const referencia = document.getElementById('referencia').value.trim();
    const data = document.getElementById('data').value.trim();
    const alterador = document.getElementById('alterador').value.trim();

    errorMsg.style.display = 'none';

    if (!produto || !quantidade || !referencia || !data || !alterador) {
      errorMsg.innerText = 'Preencha todos os campos. "Quem fez a alteração" é obrigatório.';
      errorMsg.style.display = 'block';
      return;
    }

    // Data YYYY-MM-DD simples validação
    if (!/^\d{4}-\d{2}-\d{2}$/.test(data)) {
      errorMsg.innerText = 'Data inválida. Use o formato YYYY-MM-DD.';
      errorMsg.style.display = 'block';
      return;
    }

    const tbody = document.querySelector('#estoqueTable tbody');
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td>${produto}</td>
      <td>${quantidade}</td>
      <td>${referencia}</td>
      <td>${data}</td>
      <td>${alterador}</td>
      <td>
        <button onclick="removeRow(this)" style="background:#cc4444;">Remover</button>
      </td>
    `;
    tbody.appendChild(tr);

    // limpar campos
    document.getElementById('produto').value = '';
    document.getElementById('quantidade').value = '';
    document.getElementById('referencia').value = '';
    document.getElementById('data').value = '';
    document.getElementById('alterador').value = '';
  }

  function removeRow(btn) {
    const tr = btn.closest('tr');
    tr.remove();
  }

  function searchTable() {
    const filter = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#estoqueTable tbody tr');

    rows.forEach(row => {
      const produto = row.cells[0].innerText.toLowerCase();
      if (produto.indexOf(filter) > -1) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  }

  // Salvar dados em JSON
  function saveTable() {
    const rows = document.querySelectorAll('#estoqueTable tbody tr');
    const data = [];

    rows.forEach(row => {
      data.push({
        produto: row.cells[0].innerText,
        quantidade: row.cells[1].innerText,
        referencia: row.cells[2].innerText,
        data: row.cells[3].innerText,
        alterador: row.cells[4].innerText,
      });
    });

    const jsonStr = JSON.stringify(data, null, 2);
    const blob = new Blob([jsonStr], {type: "application/json"});
    const url = URL.createObjectURL(blob);

    const a = document.createElement('a');
    a.href = url;
    a.download = 'estoque_dados.json';
    a.click();
    URL.revokeObjectURL(url);
  }

  // Carregar dados de arquivo JSON
  function loadTable() {
    const fileInput = document.getElementById('loadFile');
    if (!fileInput.files.length) {
      alert('Selecione um arquivo JSON para carregar.');
      return;
    }
    const file = fileInput.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
      try {
        const data = JSON.parse(e.target.result);
        const tbody = document.querySelector('#estoqueTable tbody');
        tbody.innerHTML = '';

        data.forEach(item => {
          if (!item.produto || !item.quantidade || !item.referencia || !item.data || !item.alterador) {
            throw new Error('Arquivo JSON inválido: faltam campos.');
          }
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.produto}</td>
            <td>${item.quantidade}</td>
            <td>${item.referencia}</td>
            <td>${item.data}</td>
            <td>${item.alterador}</td>
            <td><button onclick="removeRow(this)" style="background:#cc4444;">Remover</button></td>
          `;
          tbody.appendChild(tr);
        });
      } catch {
        alert('Erro ao ler arquivo JSON. Verifique o formato.');
      }
    };
    reader.readAsText(file);
  }

  // Exportar para Excel usando SheetJS
  function exportToExcel() {
    const rows = [];
    const header = ['Produto', 'Quantidade', 'Referência', 'Data', 'Quem fez a alteração'];
    rows.push(header);

    document.querySelectorAll('#estoqueTable tbody tr').forEach(row => {
      const rowData = [];
      for (let i = 0; i < 5; i++) {
        rowData.push(row.cells[i].innerText);
      }
      rows.push(rowData);
    });

    const ws = XLSX.utils.aoa_to_sheet(rows);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Estoque');

    XLSX.writeFile(wb, 'estoque.xlsx');
  }
</script>

</body>
</html>
