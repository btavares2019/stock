<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestão de Estoque</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    #loginForm, #app { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; }
    #app { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input[type="text"], input[type="number"], input[type="date"], input[type="password"] {
      width: 100%; padding: 6px; box-sizing: border-box;
    }
    .btn { padding: 6px 12px; margin: 5px 2px; cursor: pointer; }
    #logo { display: block; margin: 0 auto 20px auto; max-width: 200px; }
    #msgErro { color: red; display: none; margin-top: 10px; }
    .removeBtn { background-color: #e74c3c; color: white; border: none; border-radius: 4px; }
    .removeBtn:hover { background-color: #c0392b; }
  </style>
</head>
<body>

<div id="loginForm">
  <img id="logo" src="https://inovar-mais.com/wp-content/uploads/2020/07/inovarmais_logo_branco.png" alt="Logo Inovar Mais" />
  <h2>Login</h2>
  <label for="username">Usuário:</label><br>
  <input type="text" id="username" autocomplete="username" /><br><br>
  <label for="password">Senha:</label><br>
  <input type="password" id="password" autocomplete="current-password" /><br><br>
  <button class="btn" id="loginBtn">Entrar</button>
  <p id="msgErro">Usuário ou senha incorretos.</p>
</div>

<div id="app">
  <h2>Controle de Estoque</h2>
  <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Procurar produto..." />
  <button class="btn" onclick="addRow()">Adicionar Produto</button>
  <button class="btn" onclick="exportToExcel()">Exportar Excel</button>

  <table id="estoqueTable">
    <thead>
      <tr>
        <th>Produto</th>
        <th>Quantidade</th>
        <th>Referência</th>
        <th>Data Última Alteração</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody>
      <!-- Linhas dinâmicas -->
    </tbody>
  </table>
</div>

<script>
  const USER = 'admin';
  const PASS = '12345';

  const loginBtn = document.getElementById('loginBtn');
  const msgErro = document.getElementById('msgErro');

  loginBtn.addEventListener('click', () => {
    const userInput = document.getElementById('username').value.trim();
    const passInput = document.getElementById('password').value.trim();

    if(userInput === USER && passInput === PASS) {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('app').style.display = 'block';
      msgErro.style.display = 'none';
      loadTableFromStorage();
    } else {
      msgErro.style.display = 'block';
    }
  });

  function addRow(produto = '', quantidade = '', referencia = '', dataAlteracao = '') {
    const tbody = document.querySelector('#estoqueTable tbody');
    const tr = document.createElement('tr');

    if (!dataAlteracao) {
      const hoje = new Date();
      dataAlteracao = hoje.toISOString().split('T')[0];
    }

    tr.innerHTML = `
      <td><input type="text" class="produto" value="${produto}" oninput="updateDate(this)"></td>
      <td><input type="number" class="quantidade" min="0" value="${quantidade}" oninput="updateDate(this)"></td>
      <td><input type="text" class="referencia" value="${referencia}" oninput="updateDate(this)"></td>
      <td><input type="date" class="dataAlteracao" value="${dataAlteracao}" readonly></td>
      <td><button class="removeBtn btn" onclick="removeRow(this)">Remover</button></td>
    `;

    tbody.appendChild(tr);
    saveTableToStorage();
  }

  function removeRow(button) {
    button.closest('tr').remove();
    saveTableToStorage();
  }

  function updateDate(inputElement) {
    const tr = inputElement.closest('tr');
    const dataInput = tr.querySelector('.dataAlteracao');
    const hoje = new Date();
    dataInput.value = hoje.toISOString().split('T')[0];
    saveTableToStorage();
  }

  function searchTable() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#estoqueTable tbody tr');

    rows.forEach(row => {
      const produto = row.querySelector('.produto').value.toLowerCase();
      row.style.display = produto.includes(input) ? '' : 'none';
    });
  }

  function exportToExcel() {
    const rows = document.querySelectorAll('#estoqueTable tr');
    let csvContent = '';

    rows.forEach(row => {
      const cols = row.querySelectorAll('th, td');
      const rowData = [];
      cols.forEach(col => {
        const input = col.querySelector('input');
        if (input) {
          rowData.push(input.value.replace(/;/g, ','));
        } else {
          rowData.push(col.textContent.trim().replace(/;/g, ','));
        }
      });
      csvContent += rowData.join(';') + '\n';
    });

    const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'estoque.csv';
    a.click();
    URL.revokeObjectURL(url);
  }

  function saveTableToStorage() {
    const rows = document.querySelectorAll('#estoqueTable tbody tr');
    const data = [];

    rows.forEach(row => {
      const produto = row.querySelector('.produto').value;
      const quantidade = row.querySelector('.quantidade').value;
      const referencia = row.querySelector('.referencia').value;
      const dataAlteracao = row.querySelector('.dataAlteracao').value;
      data.push({ produto, quantidade, referencia, dataAlteracao });
    });

    localStorage.setItem('estoqueData', JSON.stringify(data));
  }

  function loadTableFromStorage() {
    const data = JSON.parse(localStorage.getItem('estoqueData') || '[]');
    data.forEach(item => {
      addRow(item.produto, item.quantidade, item.referencia, item.dataAlteracao);
    });
  }
</script>

</body>
</html>
