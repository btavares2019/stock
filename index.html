<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Gestão de Stock e Utilizadores</title>
  
  <!-- Font Awesome for Icons -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  />
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS CDN -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  
  <style>
    /* RESET */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #222;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1, h2, h3 {
      margin-bottom: 1rem;
    }
    /* CONTAINER */
    #loginForm, #app {
      background: #fff;
      border-radius: 12px;
      padding: 30px 40px;
      box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
      max-width: 960px;
      width: 100%;
      display: none;
    }
    #loginForm.active, #app.active {
      display: block;
    }

    /* LOGIN FORM */
    #loginForm {
      max-width: 400px;
      margin-top: 5rem;
    }
    #loginForm label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 600;
      color: #444;
    }
    #loginForm input {
      width: 100%;
      padding: 0.7rem 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      border: 1.5px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    #loginForm input:focus {
      outline: none;
      border-color: #764ba2;
      box-shadow: 0 0 8px #764ba2aa;
    }
    #loginForm button {
      width: 100%;
      background: #764ba2;
      color: white;
      font-weight: 700;
      padding: 0.8rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background-color 0.3s ease;
    }
    #loginForm button:hover {
      background: #5a3577;
    }
    #msgErro {
      color: #d64545;
      margin-top: 0.5rem;
      font-weight: 700;
      display: none;
      text-align: center;
    }

    /* NAVIGATION */
    nav {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    nav button {
      background: #764ba2;
      color: white;
      border: none;
      padding: 10px 18px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: background-color 0.3s ease;
    }
    nav button:hover {
      background: #5a3577;
    }
    nav button.active {
      background: #5a3577;
      font-weight: 700;
    }

    /* SECTIONS */
    section {
      display: none;
      animation: fadeIn 0.6s ease forwards;
    }
    section.active {
      display: block;
    }

    /* TABLES */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      box-shadow: 0 3px 12px rgb(0 0 0 / 0.1);
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      text-align: center;
      padding: 12px 10px;
      background: #fafafa;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #764ba2;
      color: white;
      font-weight: 600;
      user-select: none;
      cursor: pointer;
    }
    tr:hover td {
      background: #f0e9f9;
    }
    td input[type="text"], td input[type="number"], td select {
      width: 100%;
      padding: 6px 8px;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    /* BUTTONS */
    .btn {
      background: #764ba2;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn:hover {
      background: #5a3577;
    }
    .btn-danger {
      background: #d64545;
    }
    .btn-danger:hover {
      background: #a83333;
    }
    .btn-secondary {
      background: #444;
    }
    .btn-secondary:hover {
      background: #222;
    }

    /* FORM INLINE */
    .form-inline {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 12px;
    }
    .form-inline > * {
      flex: 1 1 120px;
    }
    .form-inline label {
      font-weight: 600;
      font-size: 0.9rem;
    }

    /* FOOTER */
    footer {
      margin-top: 40px;
      font-size: 0.85rem;
      color: #eee;
      user-select: none;
      text-align: center;
    }

    /* SEARCH BOX */
    #searchStock {
      width: 300px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1.5px solid #764ba2;
      font-size: 1rem;
      margin-bottom: 10px;
      transition: box-shadow 0.3s ease;
    }
    #searchStock:focus {
      outline: none;
      box-shadow: 0 0 8px #764ba2aa;
    }

    /* TOGGLE SWITCH */
    .switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 28px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #764ba2;
    }
    input:checked + .slider:before {
      transform: translateX(24px);
    }

    /* RESPONSIVE */
    @media (max-width: 720px) {
      #loginForm, #app {
        padding: 20px;
      }
      nav button {
        font-size: 0.9rem;
        padding: 8px 12px;
      }
      #searchStock {
        width: 100%;
      }
      table, th, td {
        font-size: 0.85rem;
      }
    }

    /* ANIMATION */
    @keyframes fadeIn {
      from {opacity: 0;}
      to {opacity: 1;}
    }

  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginForm" class="active" role="main" aria-label="Formulário de Login">
  <h1>Gestão de Stock - Login</h1>
  <label for="inputUsername">Utilizador:</label>
  <input type="text" id="inputUsername" autocomplete="username" aria-required="true" />
  
  <label for="inputPassword">Senha:</label>
  <input type="password" id="inputPassword" autocomplete="current-password" aria-required="true" />
  
  <button id="btnLogin"><i class="fas fa-sign-in-alt"></i> Entrar</button>
  <p id="msgErro" role="alert" aria-live="assertive"></p>
</div>

<!-- APP -->
<div id="app" aria-live="polite" aria-atomic="true" aria-label="Aplicação de Gestão de Stock e Utilizadores">

  <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
    <h1>Gestão de Stock</h1>
    <div style="display:flex; align-items:center; gap:15px;">
      <button id="btnLogout" class="btn" title="Terminar Sessão">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
      <label class="switch" title="Alternar tema claro/escuro">
        <input type="checkbox" id="toggleTheme" aria-label="Alternar tema claro e escuro">
        <span class="slider"></span>
      </label>
    </div>
  </header>

  <nav aria-label="Navegação principal">
    <button id="tabStock" class="active" aria-controls="sectionStock" aria-selected="true" role="tab">
      <i class="fas fa-boxes"></i> Stock
    </button>
    <button id="tabUtilizadores" aria-controls="sectionUtilizadores" role="tab">
      <i class="fas fa-users"></i> Utilizadores
    </button>
    <button id="tabDashboard" aria-controls="sectionDashboard" role="tab">
      <i class="fas fa-chart-pie"></i> Dashboard
    </button>
  </nav>

  <!-- STOCK -->
  <section id="sectionStock" class="active" role="tabpanel" tabindex="0" aria-labelledby="tabStock">
    <div class="form-inline" style="justify-content: space-between; flex-wrap: wrap;">
      <input type="text" id="searchStock" placeholder="Procurar produto..." aria-label="Pesquisar produto no stock" />
      <div style="display:flex; gap:10px; flex-wrap: wrap;">
        <button class="btn" id="btnAddProduct" title="Adicionar novo produto">
          <i class="fas fa-plus"></i> Adicionar Produto
        </button>
        <button class="btn" id="btnSaveStock" title="Guardar alterações do stock">
          <i class="fas fa-save"></i> Guardar
        </button>
        <button class="btn" id="btnExportStock" title="Exportar stock para XLSX">
          <i class="fas fa-file-export"></i> Exportar XLSX
        </button>
        <button class="btn btn-danger" id="btnResetQuantities" title="Resetar todas as quantidades para zero">
          <i class="fas fa-undo-alt"></i> Reset Quantidades
        </button>
      </div>
    </div>
    <table aria-describedby="stockTableDesc" id="tableStock" role="grid" aria-live="polite">
      <caption id="stockTableDesc">Tabela com lista dos produtos em stock.</caption>
      <thead>
        <tr>
          <th>ID</th>
          <th>Produto</th>
          <th>Quantidade</th>
          <th>Referência</th>
          <th>Última Alteração</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tbodyStock"></tbody>
    </table>
  </section>

  <!-- UTILIZADORES -->
  <section id="sectionUtilizadores" role="tabpanel" tabindex="0" aria-labelledby="tabUtilizadores">
    <div class="form-inline" style="justify-content: space-between; flex-wrap: wrap;">
      <input type="text" id="searchUtilizador" placeholder="Procurar utilizador..." aria-label="Pesquisar utilizador" />
      <div style="display:flex; gap:10px; flex-wrap: wrap;">
        <button class="btn" id="btnAddUser" title="Adicionar novo utilizador">
          <i class="fas fa-user-plus"></i> Adicionar Utilizador
        </button>
        <button class="btn" id="btnSaveUsers" title="Guardar alterações dos utilizadores">
          <i class="fas fa-save"></i> Guardar
        </button>
      </div>
    </div>
    <table aria-describedby="usersTableDesc" id="tableUtilizadores" role="grid" aria-live="polite">
      <caption id="usersTableDesc">Tabela com lista de utilizadores.</caption>
      <thead>
        <tr>
          <th>ID</th>
          <th>Utilizador</th>
          <th>Permissão</th>
          <th>Ativo</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="tbodyUtilizadores"></tbody>
    </table>
  </section>

  <!-- DASHBOARD -->
  <section id="sectionDashboard" role="tabpanel" tabindex="0" aria-labelledby="tabDashboard">
    <h2>Dashboard de Stock</h2>
    <canvas id="chartStock" aria-label="Gráfico de barras das quantidades de stock" role="img" style="max-width: 100%; height: 400px;"></canvas>
  </section>

  <footer>
    Produzido por Bruno Tavares 2025
  </footer>
</div>

<script>
(() => {
  // Estado
  let utilizadores = JSON.parse(localStorage.getItem('utilizadores')) || [
    { id: 1, username: 'admin', password: 'admin123', permission: 'admin', active: true },
    { id: 2, username: 'vendedor', password: 'venda123', permission: 'vendedor', active: true },
    { id: 3, username: 'gestor', password: 'gestor123', permission: 'gestor', active: true }
  ];
  let stock = JSON.parse(localStorage.getItem('stock')) || [];
  let loggedInUser = JSON.parse(sessionStorage.getItem('loggedInUser')) || null;
  let currentTab = 'stock';
  let chartInstance = null;

  // ELEMENTS
  const loginForm = document.getElementById('loginForm');
  const app = document.getElementById('app');
  const inputUsername = document.getElementById('inputUsername');
  const inputPassword = document.getElementById('inputPassword');
  const msgErro = document.getElementById('msgErro');
  const btnLogin = document.getElementById('btnLogin');
  const btnLogout = document.getElementById('btnLogout');
  const tabStock = document.getElementById('tabStock');
  const tabUtilizadores = document.getElementById('tabUtilizadores');
  const tabDashboard = document.getElementById('tabDashboard');
  const sectionStock = document.getElementById('sectionStock');
  const sectionUtilizadores = document.getElementById('sectionUtilizadores');
  const sectionDashboard = document.getElementById('sectionDashboard');
  const tbodyStock = document.getElementById('tbodyStock');
  const tbodyUtilizadores = document.getElementById('tbodyUtilizadores');
  const btnAddProduct = document.getElementById('btnAddProduct');
  const btnSaveStock = document.getElementById('btnSaveStock');
  const btnExportStock = document.getElementById('btnExportStock');
  const btnResetQuantities = document.getElementById('btnResetQuantities');
  const btnAddUser = document.getElementById('btnAddUser');
  const btnSaveUsers = document.getElementById('btnSaveUsers');
  const searchStock = document.getElementById('searchStock');
  const searchUtilizador = document.getElementById('searchUtilizador');
  const toggleTheme = document.getElementById('toggleTheme');
  const chartStock = document.getElementById('chartStock').getContext('2d');

  // Funções utilitárias
  const generateId = (arr) => arr.length ? Math.max(...arr.map(x => x.id)) + 1 : 1;
  const formatDateTime = (date) => new Date(date).toLocaleString('pt-PT', { dateStyle: 'short', timeStyle: 'short' });

  // === LOGIN ===
  function login() {
    const username = inputUsername.value.trim();
    const password = inputPassword.value.trim();

    const user = utilizadores.find(u => u.username === username && u.password === password);

    if (!user) {
      msgErro.textContent = 'Utilizador ou senha incorretos.';
      msgErro.style.display = 'block';
      return;
    }
    if (!user.active) {
      msgErro.textContent = 'Utilizador inativo. Contacte o administrador.';
      msgErro.style.display = 'block';
      return;
    }

    loggedInUser = { id: user.id, username: user.username, permission: user.permission };
    sessionStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
    msgErro.style.display = 'none';
    inputPassword.value = '';
    inputUsername.value = '';

    showApp();
  }

  btnLogin.addEventListener('click', login);
  inputPassword.addEventListener('keydown', e => { if(e.key === 'Enter') login(); });

  // === SHOW APP ===
  function showApp() {
    loginForm.classList.remove('active');
    app.classList.add('active');
    renderTabs();
    renderStock();
    renderUtilizadores();
    renderDashboard();
    renderUserGreeting();
  }

  // === LOGOUT ===
  btnLogout.addEventListener('click', () => {
    sessionStorage.removeItem('loggedInUser');
    loggedInUser = null;
    app.classList.remove('active');
    loginForm.classList.add('active');
  });

  // === NAV TABS ===
  function renderTabs() {
    [tabStock, tabUtilizadores, tabDashboard].forEach(btn => {
      btn.classList.remove('active');
      btn.setAttribute('aria-selected', 'false');
    });
    sectionStock.classList.remove('active');
    sectionUtilizadores.classList.remove('active');
    sectionDashboard.classList.remove('active');

    if(currentTab === 'stock') {
      tabStock.classList.add('active');
      tabStock.setAttribute('aria-selected', 'true');
      sectionStock.classList.add('active');
    } else if(currentTab === 'utilizadores') {
      tabUtilizadores.classList.add('active');
      tabUtilizadores.setAttribute('aria-selected', 'true');
      sectionUtilizadores.classList.add('active');
    } else if(currentTab === 'dashboard') {
      tabDashboard.classList.add('active');
      tabDashboard.setAttribute('aria-selected', 'true');
      sectionDashboard.classList.add('active');
    }
  }

  tabStock.addEventListener('click', () => { currentTab = 'stock'; renderTabs(); });
  tabUtilizadores.addEventListener('click', () => { currentTab = 'utilizadores'; renderTabs(); });
  tabDashboard.addEventListener('click', () => { currentTab = 'dashboard'; renderTabs(); renderDashboard(); });

  // === RENDER STOCK ===
  function renderStock(filter = '') {
    tbodyStock.innerHTML = '';
    let filteredStock = stock.filter(p => p.nome.toLowerCase().includes(filter.toLowerCase()) || p.referencia.toLowerCase().includes(filter.toLowerCase()));

    filteredStock.forEach(produto => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${produto.id}</td>
        <td><input type="text" value="${produto.nome}" aria-label="Nome do produto ${produto.id}" /></td>
        <td><input type="number" min="0" value="${produto.quantidade}" aria-label="Quantidade do produto ${produto.id}" /></td>
        <td><input type="text" value="${produto.referencia}" aria-label="Referência do produto ${produto.id}" /></td>
        <td>${formatDateTime(produto.ultimaAlteracao)}</td>
        <td>
          <button class="btn btn-danger btnDeleteProduct" title="Apagar produto" aria-label="Apagar produto ${produto.nome}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;

      // EDITAR PRODUTO
      const inputs = tr.querySelectorAll('input');
      inputs[0].addEventListener('change', e => {
        const novoNome = e.target.value.trim();
        if (!novoNome) {
          alert('O nome do produto não pode estar vazio.');
          e.target.value = produto.nome;
          return;
        }
        if(stock.some(p => p.nome.toLowerCase() === novoNome.toLowerCase() && p.id !== produto.id)) {
          alert('Já existe um produto com esse nome.');
          e.target.value = produto.nome;
          return;
        }
        produto.nome = novoNome;
        produto.ultimaAlteracao = new Date().toISOString();
        renderStock(searchStock.value);
      });
      inputs[1].addEventListener('change', e => {
        let novaQuant = parseInt(e.target.value);
        if (isNaN(novaQuant) || novaQuant < 0) {
          alert('Quantidade inválida.');
          e.target.value = produto.quantidade;
          return;
        }
        produto.quantidade = novaQuant;
        produto.ultimaAlteracao = new Date().toISOString();
        renderStock(searchStock.value);
      });
      inputs[2].addEventListener('change', e => {
        produto.referencia = e.target.value.trim();
        produto.ultimaAlteracao = new Date().toISOString();
        renderStock(searchStock.value);
      });

      // DELETE PRODUCT
      tr.querySelector('.btnDeleteProduct').addEventListener('click', () => {
        if(confirm(`Deseja realmente apagar o produto "${produto.nome}"?`)) {
          stock = stock.filter(p => p.id !== produto.id);
          saveStock();
          renderStock(searchStock.value);
          renderDashboard();
        }
      });

      tbodyStock.appendChild(tr);
    });
  }

  searchStock.addEventListener('input', () => renderStock(searchStock.value));

  // === ADD PRODUCT ===
  btnAddProduct.addEventListener('click', () => {
    const novoId = generateId(stock);
    const novoProduto = {
      id: novoId,
      nome: 'Novo Produto',
      quantidade: 0,
      referencia: '',
      ultimaAlteracao: new Date().toISOString()
    };
    stock.push(novoProduto);
    saveStock();
    renderStock();
    renderDashboard();
  });

  // === SAVE STOCK ===
  btnSaveStock.addEventListener('click', () => {
    saveStock();
    alert('Stock guardado com sucesso!');
  });

  function saveStock() {
    localStorage.setItem('stock', JSON.stringify(stock));
  }

  // === RESET QUANTITIES ===
  btnResetQuantities.addEventListener('click', () => {
    if(confirm('Tem certeza que quer resetar todas as quantidades para zero?')) {
      stock.forEach(p => {
        p.quantidade = 0;
        p.ultimaAlteracao = new Date().toISOString();
      });
      saveStock();
      renderStock();
      renderDashboard();
    }
  });

  // === EXPORTAR PARA XLSX ===
  btnExportStock.addEventListener('click', () => {
    if(!stock.length){
      alert('Não há produtos para exportar.');
      return;
    }
    // Criar worksheet
    const wsData = [
      ['ID', 'Produto', 'Quantidade', 'Referência', 'Última Alteração'],
      ...stock.map(p => [p.id, p.nome, p.quantidade, p.referencia, formatDateTime(p.ultimaAlteracao)])
    ];
    const ws = XLSX.utils.aoa_to_sheet(wsData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, 'Stock');
    XLSX.writeFile(wb, 'stock.xlsx');
  });

  // === RENDER UTILIZADORES ===
  function renderUtilizadores(filter = '') {
    tbodyUtilizadores.innerHTML = '';
    let filteredUsers = utilizadores.filter(u => u.username.toLowerCase().includes(filter.toLowerCase()));

    filteredUsers.forEach(user => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${user.id}</td>
        <td><input type="text" value="${user.username}" aria-label="Nome do utilizador ${user.id}" /></td>
        <td>
          <select aria-label="Permissão do utilizador ${user.id}">
            <option value="admin" ${user.permission === 'admin' ? 'selected' : ''}>Admin</option>
            <option value="vendedor" ${user.permission === 'vendedor' ? 'selected' : ''}>Vendedor</option>
            <option value="gestor" ${user.permission === 'gestor' ? 'selected' : ''}>Gestor</option>
          </select>
        </td>
        <td>
          <input type="checkbox" ${user.active ? 'checked' : ''} aria-label="Utilizador ativo ${user.id}" />
        </td>
        <td>
          <button class="btn btn-danger btnDeleteUser" title="Apagar utilizador" aria-label="Apagar utilizador ${user.username}">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      `;

      // EDITAR UTILIZADOR
      const inputs = tr.querySelectorAll('input, select');
      inputs[0].addEventListener('change', e => {
        const novoNome = e.target.value.trim();
        if (!novoNome) {
          alert('O nome do utilizador não pode estar vazio.');
          e.target.value = user.username;
          return;
        }
        if(utilizadores.some(u => u.username.toLowerCase() === novoNome.toLowerCase() && u.id !== user.id)) {
          alert('Já existe um utilizador com esse nome.');
          e.target.value = user.username;
          return;
        }
        user.username = novoNome;
        saveUtilizadores();
        renderUtilizadores(searchUtilizador.value);
      });
      inputs[1].addEventListener('change', e => {
        user.permission = e.target.value;
        saveUtilizadores();
      });
      inputs[2].addEventListener('change', e => {
        user.active = e.target.checked;
        saveUtilizadores();
      });

      // DELETE USER
      tr.querySelector('.btnDeleteUser').addEventListener('click', () => {
        if(confirm(`Deseja realmente apagar o utilizador "${user.username}"?`)) {
          utilizadores = utilizadores.filter(u => u.id !== user.id);
          saveUtilizadores();
          renderUtilizadores(searchUtilizador.value);
        }
      });

      tbodyUtilizadores.appendChild(tr);
    });
  }

  searchUtilizador.addEventListener('input', () => renderUtilizadores(searchUtilizador.value));

  // === ADD USER ===
  btnAddUser.addEventListener('click', () => {
    const novoId = generateId(utilizadores);
    const novoUser = {
      id: novoId,
      username: 'Novo Utilizador',
      permission: 'vendedor',
      active: true
    };
    utilizadores.push(novoUser);
    saveUtilizadores();
    renderUtilizadores();
  });

  // === SAVE USERS ===
  function saveUtilizadores() {
    localStorage.setItem('utilizadores', JSON.stringify(utilizadores));
  }

  // === RENDER DASHBOARD ===
  function renderDashboard() {
    // Quantidade total de produtos
    const totalProdutos = stock.length;
    // Soma das quantidades
    const somaQuantidades = stock.reduce((acc, p) => acc + p.quantidade, 0);
    // Número de utilizadores ativos
    const totalUtilizadoresAtivos = utilizadores.filter(u => u.active).length;

    totalProdutosElem.textContent = totalProdutos;
    somaQuantidadesElem.textContent = somaQuantidades;
    totalUtilizadoresAtivosElem.textContent = totalUtilizadoresAtivos;
  }

  // === USER GREETING ===
  function renderUserGreeting() {
    if(loggedInUser) {
      userGreeting.textContent = `Olá, ${loggedInUser.username}!`;
    } else {
      userGreeting.textContent = '';
    }
  }

  // === HELPER FUNCTIONS ===
  function formatDateTime(dateTimeStr) {
    const date = new Date(dateTimeStr);
    return date.toLocaleString('pt-PT', {
      day: '2-digit', month: '2-digit', year: 'numeric',
      hour: '2-digit', minute: '2-digit', second: '2-digit'
    });
  }

  function generateId(arr) {
    return arr.length ? Math.max(...arr.map(item => item.id)) + 1 : 1;
  }

  // === INIT ===
  loadData();

})();  
