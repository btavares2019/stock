<!DOCTYPE html>
<html lang="pt-PT">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gestão de Produtos - Bruno Tavares 2025</title>
<style>
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    color: #333;
    margin: 0; padding: 0;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: #2563eb;
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  header button {
    background: #fbbf24;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  header button:hover {
    background: #f59e0b;
  }
  main {
    flex-grow: 1;
    padding: 2rem;
    max-width: 900px;
    margin: auto;
  }
  h1, h2 {
    margin-bottom: 1rem;
  }
  nav {
    margin-bottom: 2rem;
  }
  nav button {
    background: #2563eb;
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    margin-right: 0.5rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  nav button.active, nav button:hover {
    background: #1e40af;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 0.6rem 1rem;
    text-align: left;
  }
  th {
    background: #2563eb;
    color: white;
  }
  input[type=text], input[type=number], input[type=password] {
    padding: 0.4rem 0.6rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    margin-right: 1rem;
    width: 200px;
  }
  input[type=number] {
    max-width: 120px;
  }
  .flex-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }
  .btn {
    background: #2563eb;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s ease;
  }
  .btn:hover {
    background: #1e40af;
  }
  .btn-danger {
    background: #f87171;
  }
  .btn-danger:hover {
    background: #ef4444;
  }
  footer {
    text-align: center;
    padding: 1rem;
    font-size: 0.9rem;
    background: #f0f0f0;
    margin-top: auto;
  }
  .hidden {
    display: none;
  }
  #exportButtons {
    margin-top: 1rem;
  }
  #exportButtons button {
    margin-right: 0.8rem;
  }
</style>
</head>
<body>

<header>
  <div>
    <strong>Gestão de Produtos</strong>
  </div>
  <div>
    <span id="lastLoginDisplay"></span>
    <button id="logoutBtn" class="hidden">Logout</button>
  </div>
</header>

<main>
  <nav>
    <button class="active" data-tab="produtos">Produtos</button>
    <button data-tab="historico">Histórico</button>
    <button data-tab="utilizadores">Utilizadores</button>
  </nav>

  <!-- Login -->
  <section id="loginSection">
    <h2>Iniciar Sessão</h2>
    <div class="flex-row" style="margin-bottom:1rem;">
      <input type="text" id="loginUsername" placeholder="Nome de utilizador" autocomplete="username"/>
      <input type="password" id="loginPassword" placeholder="Palavra-passe" autocomplete="current-password"/>
      <button class="btn" id="loginBtn">Entrar</button>
    </div>
    <div id="loginMsg" style="color: red;"></div>
  </section>

  <!-- Produtos -->
  <section id="produtosSection" class="hidden" aria-label="Gestão de produtos">
    <h2>Produtos</h2>
    <div class="flex-row" style="margin-bottom:1rem;">
      <input type="text" id="filterName" placeholder="Pesquisar por nome" aria-label="Pesquisar por nome do produto" />
      <input type="number" id="filterQty" min="0" placeholder="Quantidade inferior a" aria-label="Filtrar produtos por quantidade inferior a" />
    </div>

    <table aria-label="Tabela de produtos">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Quantidade</th>
          <th>Data da última alteração</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="productTable"></tbody>
    </table>

    <div id="exportButtons" class="flex-row">
      <button class="btn" id="exportExcelBtn" aria-label="Exportar produtos para Excel">Exportar Excel</button>
      <button class="btn" id="exportPdfBtn" aria-label="Exportar produtos para PDF">Exportar PDF</button>
      <button class="btn" id="printBtn" aria-label="Imprimir tabela de produtos">Imprimir</button>
    </div>

    <h3>Adicionar / Editar Produto</h3>
    <div class="flex-row" style="margin-bottom:1rem; gap:0.5rem;">
      <input type="text" id="productName" placeholder="Nome do produto" aria-label="Nome do produto" />
      <input type="number" id="productQty" min="0" placeholder="Quantidade" aria-label="Quantidade do produto" />
      <button class="btn" id="addEditProductBtn">Adicionar</button>
      <button class="btn btn-danger hidden" id="cancelEditBtn">Cancelar</button>
    </div>
  </section>

  <!-- Histórico -->
  <section id="historicoSection" class="hidden" aria-label="Histórico de contagens">
    <h2>Histórico de Contagens</h2>
    <table aria-label="Histórico de produtos">
      <thead>
        <tr><th>Data</th><th>Produto</th><th>Quantidade</th></tr>
      </thead>
      <tbody id="historicoTable"></tbody>
    </table>
  </section>

  <!-- Utilizadores -->
  <section id="utilizadoresSection" class="hidden" aria-label="Gestão de utilizadores">
    <h2>Gestão de Utilizadores</h2>

    <table aria-label="Tabela de utilizadores" style="margin-bottom:1rem;">
      <thead>
        <tr><th>Nome de utilizador</th><th>Último login</th><th>Ações</th></tr>
      </thead>
      <tbody id="utilizadoresTable"></tbody>
    </table>

    <h3>Adicionar Utilizador</h3>
    <div class="flex-row" style="margin-bottom:1rem; gap:0.5rem;">
      <input type="text" id="newUsername" placeholder="Nome de utilizador" aria-label="Nome de utilizador" autocomplete="username"/>
      <input type="password" id="newPassword" placeholder="Palavra-passe" aria-label="Palavra-passe" autocomplete="new-password"/>
      <button class="btn" id="addUserBtn">Adicionar</button>
    </div>
    <div id="userMsg" style="color:red;"></div>
  </section>
</main>

<footer>
  Criado por Bruno Tavares 2025
</footer>

<!-- Bibliotecas externas -->
<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>

<script>
  // --- Dados e armazenamento ---
  let currentUser = null;
  let editingProductIndex = null;

  function saveUsers(users) {
    localStorage.setItem('users', JSON.stringify(users));
  }

  function loadUsers() {
    let users = localStorage.getItem('users');
    if (!users) {
      // criar utilizador padrão
      users = [{ username: "admin", password: "admin", lastLogin: null }];
      saveUsers(users);
    } else {
      users = JSON.parse(users);
    }
    return users;
  }

  function saveProducts(products) {
    localStorage.setItem('products', JSON.stringify(products));
  }

  function loadProducts() {
    let products = localStorage.getItem('products');
    if (!products) {
      products = [];
      saveProducts(products);
    } else {
      products = JSON.parse(products);
    }
    return products;
  }

  function saveHistorico(historico) {
    localStorage.setItem('historico', JSON.stringify(historico));
  }

  function loadHistorico() {
    let historico = localStorage.getItem('historico');
    if (!historico) {
      historico = [];
      saveHistorico(historico);
    } else {
      historico = JSON.parse(historico);
    }
    return historico;
  }

  // --- UI e lógica ---
  const loginSection = document.getElementById('loginSection');
  const produtosSection = document.getElementById('produtosSection');
  const historicoSection = document.getElementById('historicoSection');
  const utilizadoresSection = document.getElementById('utilizadoresSection');
  const lastLoginDisplay = document.getElementById('lastLoginDisplay');

  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');
const loginMsg = document.getElementById('loginMsg');
const logoutBtn = document.getElementById('logoutBtn');

const filterName = document.getElementById('filterName');
const filterQty = document.getElementById('filterQty');
const productTable = document.getElementById('productTable');
const historicoTable = document.getElementById('historicoTable');

const exportExcelBtn = document.getElementById('exportExcelBtn');
const exportPdfBtn = document.getElementById('exportPdfBtn');
const printBtn = document.getElementById('printBtn');

// --- Exportação ---
exportExcelBtn.onclick = () => {
const rows = Array.from(productTable.querySelectorAll('tr')).map(row => {
const cols = row.querySelectorAll('td');
return Array.from(cols).slice(0, 3).map(cell => cell.textContent.trim());
});
const wb = XLSX.utils.book_new();
const ws = XLSX.utils.aoa_to_sheet([["Nome", "Quantidade", "Última alteração"], ...rows]);
XLSX.utils.book_append_sheet(wb, ws, "Produtos");
XLSX.writeFile(wb, "produtos.xlsx");
};

exportPdfBtn.onclick = () => {
const { jsPDF } = window.jspdf;
const doc = new jsPDF();
doc.autoTable({
head: [["Nome", "Quantidade", "Última alteração"]],
body: Array.from(productTable.querySelectorAll('tr')).map(row => {
const cols = row.querySelectorAll('td');
return Array.from(cols).slice(0, 3).map(cell => cell.textContent.trim());
}),
});
doc.save("produtos.pdf");
};

printBtn.onclick = () => {
const win = window.open('', '', 'width=800,height=600');
const html = <html><head><title>Imprimir Produtos</title></head> <body> <h2>Lista de Produtos</h2> ${productTable.parentNode.innerHTML} </body></html> ;
win.document.write(html);
win.document.close();
win.print();
};
</script>

</body> </html>
