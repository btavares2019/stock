<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestão de Produtos - Bruno Tavares 2025</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: #2563eb;
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header button {
      background: #fbbf24;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
    }
    header button:hover {
      background: #f59e0b;
    }
    main {
      flex-grow: 1;
      padding: 2rem;
      max-width: 1200px;
      width: 95%;
      margin: auto;
    }
    nav {
      margin-bottom: 2rem;
      overflow-x: auto;
      white-space: nowrap;
    }
    nav button {
      background: #2563eb;
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      flex: none;
    }
    nav button.active,
    nav button:hover {
      background: #1e40af;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
      display: block;
      overflow-x: auto;
      white-space: nowrap;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 0.6rem 1rem;
      text-align: left;
    }
    th {
      background: #2563eb;
      color: white;
    }
    input[type="text"],
    input[type="number"],
    input[type="password"] {
      padding: 0.4rem 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-right: 1rem;
      min-width: 150px;
      max-width: 100%;
      flex-grow: 1;
    }
    input[type="number"] {
      max-width: 120px;
    }
    .flex-row {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      width: 100%;
    }
    .btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    .btn:hover {
      background: #1e40af;
    }
    .btn-danger {
      background: #f87171;
    }
    .btn-danger:hover {
      background: #ef4444;
    }
    footer {
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      background: #f0f0f0;
      margin-top: auto;
    }
    .hidden {
      display: none;
    }
    #exportButtons {
      margin-top: 1rem;
    }
    #exportButtons button {
      margin-right: 0.8rem;
    }
  </style>
</head>
<body>
<header>
  <strong>Gestão de Produtos</strong>
  <div>
    <span id="loginMsg"></span>
    <button id="logoutBtn" class="hidden">Terminar Sessão</button>
  </div>
</header>

<main>
  <div id="loginSection">
    <h2>Iniciar Sessão</h2>
    <input type="text" id="username" placeholder="Utilizador" />
    <input type="password" id="password" placeholder="Palavra-passe" />
    <button id="loginBtn" class="btn">Entrar</button>
  </div>

  <div id="mainApp" class="hidden">
    <nav>
      <button class="tabBtn active" data-tab="produtos">Produtos</button>
      <button class="tabBtn" data-tab="historico">Histórico de Contagens</button>
      <button class="tabBtn" data-tab="utilizadores">Gestão de Utilizadores</button>
    </nav>

    <!-- Produtos -->
    <section id="produtos" class="tabContent">
      <h2>Produtos</h2>
      <div class="flex-row">
        <input type="text" id="productName" placeholder="Nome do Produto" />
        <input type="number" id="productQty" placeholder="Quantidade" />
        <button class="btn" id="addProductBtn">Adicionar / Atualizar</button>
      </div>
      <div class="flex-row" style="margin-top: 1rem;">
        <input type="text" id="filterName" placeholder="Filtrar por nome" />
        <input type="number" id="filterQty" placeholder="Menor que quantidade" />
        <button class="btn" id="filterBtn">Filtrar</button>
      </div>
      <table id="productTable">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Quantidade</th>
            <th>Última Alteração</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div id="exportButtons">
        <button class="btn" id="exportExcelBtn">Exportar para Excel</button>
        <button class="btn" id="exportPdfBtn">Exportar para PDF</button>
        <button class="btn" id="printBtn">Imprimir</button>
      </div>
    </section>

    <!-- Histórico -->
    <section id="historico" class="tabContent hidden">
      <h2>Histórico de Contagens</h2>
      <table id="historicoTable">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Quantidade</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- Utilizadores -->
    <section id="utilizadores" class="tabContent hidden">
      <h2>Gestão de Utilizadores</h2>
      <p>Gestão fictícia. Utilizadores são guardados no localStorage deste navegador.</p>
      <ul id="userList"></ul>
    </section>
  </div>
</main>

<footer>
  Criado por Bruno Tavares 2025
</footer>

<script>
  // Dados simulados e funções utilitárias
  const produtoStorageKey = "produtos";
  const historicoStorageKey = "historico";
  const userKey = "utilizador";

  let produtos = JSON.parse(localStorage.getItem(produtoStorageKey)) || [];
  let historico = JSON.parse(localStorage.getItem(historicoStorageKey)) || [];

  function guardarProdutos() {
    localStorage.setItem(produtoStorageKey, JSON.stringify(produtos));
  }

  function guardarHistorico() {
    localStorage.setItem(historicoStorageKey, JSON.stringify(historico));
  }

  // Login
  const loginSection = document.getElementById("loginSection");
  const mainApp = document.getElementById("mainApp");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const loginMsg = document.getElementById("loginMsg");

  function verificarSessao() {
    const utilizador = localStorage.getItem(userKey);
    if (utilizador) {
      loginSection.classList.add("hidden");
      mainApp.classList.remove("hidden");
      loginMsg.innerText = `Último login: ${new Date().toLocaleString()}`;
      logoutBtn.classList.remove("hidden");
    }
  }

  loginBtn.onclick = () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    if (username && password) {
      localStorage.setItem(userKey, username);
      verificarSessao();
    } else {
      alert("Introduza o nome de utilizador e palavra-passe.");
    }
  };

  logoutBtn.onclick = () => {
    localStorage.removeItem(userKey);
    location.reload();
  };

  verificarSessao();

  // Tabs
  const tabs = document.querySelectorAll(".tabBtn");
  const contents = document.querySelectorAll(".tabContent");
  tabs.forEach(btn => {
    btn.onclick = () => {
      tabs.forEach(b => b.classList.remove("active"));
      contents.forEach(c => c.classList.add("hidden"));
      btn.classList.add("active");
      document.getElementById(btn.dataset.tab).classList.remove("hidden");
    };
  });

  // Renderizar produtos
  const productTable = document.querySelector("#productTable tbody");
  const historicoTable = document.querySelector("#historicoTable tbody");

  function renderizarProdutos(lista = produtos) {
    productTable.innerHTML = "";
    lista.forEach((p, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${p.nome}</td>
        <td>${p.quantidade}</td>
        <td>${p.data}</td>
        <td>
          <button class="btn" onclick="editarProduto(${index})">Editar</button>
          <button class="btn btn-danger" onclick="removerProduto(${index})">Remover</button>
        </td>`;
      productTable.appendChild(row);
    });
  }

  function renderizarHistorico() {
    historicoTable.innerHTML = "";
    historico.forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `<td>${item.nome}</td><td>${item.quantidade}</td><td>${item.data}</td>`;
      historicoTable.appendChild(row);
    });
  }

  // Adicionar ou atualizar
  document.getElementById("addProductBtn").onclick = () => {
    const nome = document.getElementById("productName").value.trim();
    const quantidade = parseInt(document.getElementById("productQty").value);
    if (!nome || isNaN(quantidade)) return alert("Preencha todos os campos.");

    const index = produtos.findIndex(p => p.nome.toLowerCase() === nome.toLowerCase());
    const dataAtual = new Date().toLocaleString();

    if (index >= 0) {
      produtos[index].quantidade = quantidade;
      produtos[index].data = dataAtual;
    } else {
      produtos.push({ nome, quantidade, data: dataAtual });
    }

    historico.push({ nome, quantidade, data: dataAtual });

    guardarProdutos();
    guardarHistorico();
    renderizarProdutos();
    renderizarHistorico();
    document.getElementById("productName").value = "";
    document.getElementById("productQty").value = "";
  };

  // Editar e Remover
  window.editarProduto = function (index) {
    const produto = produtos[index];
    document.getElementById("productName").value = produto.nome;
    document.getElementById("productQty").value = produto.quantidade;
  };

  window.removerProduto = function (index) {
    if (confirm("Tem a certeza que deseja remover este produto?")) {
      produtos.splice(index, 1);
      guardarProdutos();
      renderizarProdutos();
    }
  };

  // Filtros
  document.getElementById("filterBtn").onclick = () => {
    const nome = document.getElementById("filterName").value.trim().toLowerCase();
    const quantidade = parseInt(document.getElementById("filterQty").value);
    const filtrado = produtos.filter(p => {
      const matchNome = nome ? p.nome.toLowerCase().includes(nome) : true;
      const matchQtd = !isNaN(quantidade) ? p.quantidade < quantidade : true;
      return matchNome && matchQtd;
    });
    renderizarProdutos(filtrado);
  };

  // Exportações
  document.getElementById("exportExcelBtn").onclick = () => {
    const rows = produtos.map(p => [p.nome, p.quantidade, p.data]);
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.aoa_to_sheet([["Nome", "Quantidade", "Última alteração"], ...rows]);
    XLSX.utils.book_append_sheet(wb, ws, "Produtos");
    XLSX.writeFile(wb, "produtos.xlsx");
  };

  document.getElementById("exportPdfBtn").onclick = () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.autoTable({
      head: [["Nome", "Quantidade", "Última alteração"]],
      body: produtos.map(p => [p.nome, p.quantidade, p.data]),
    });
    doc.save("produtos.pdf");
  };

  document.getElementById("printBtn").onclick = () => {
    const win = window.open("", "", "width=800,height=600");
    win.document.write(`<html><head><title>Imprimir Produtos</title>`);
    win.document.write(`<style>table{width:100%;border-collapse:collapse;}th,td{border:1px solid #ddd;padding:8px;text-align:left;}th{background:#2563eb;color:#fff;}</style>`);
    win.document.write(`</head><body>`);
    win.document.write(`<h2>Lista de Produtos</h2>`);
    win.document.write(document.querySelector("#productTable").outerHTML);
    win.document.write("</body></html>");
    win.document.close();
    win.print();
  };

  // Inicialização
  renderizarProdutos();
  renderizarHistorico();
</script>
<footer>
  Criado por Bruno Tavares 2025
</footer>
</body>
</html>
