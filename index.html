<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestão de Estoque - Login e Controle</title>
  <style>
    /* Reset básico */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      height: 100%;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #6b73ff 0%, #000dff 100%);
      display: flex;
      justify-content: center;
      align-items: center;
      color: #fff;
      min-height: 100vh;
    }

    /* Container login */
    #loginForm {
      background: rgba(255, 255, 255, 0.1);
      padding: 40px 30px;
      border-radius: 12px;
      width: 320px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      text-align: center;
    }

    #loginForm h2 {
      margin-bottom: 24px;
      font-weight: 700;
      font-size: 28px;
      letter-spacing: 1.2px;
    }

    .input-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 14px;
    }

    input[type="text"], input[type="password"] {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: none;
      outline: none;
      font-size: 16px;
      transition: background 0.3s ease;
      background: rgba(255, 255, 255, 0.2);
      color: #fff;
    }

    input[type="text"]:focus, input[type="password"]:focus {
      background: rgba(255, 255, 255, 0.35);
      box-shadow: 0 0 6px #6b73ff;
    }

    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #304ffe;
      color: white;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #1a2ed0;
    }

    .error-message {
      margin-top: 15px;
      font-size: 14px;
      color: #ff6b6b;
      display: none;
    }

    /* App container */
    #app {
      display: none;
      background: #fff;
      color: #333;
      padding: 20px 30px;
      border-radius: 10px;
      max-width: 900px;
      width: 95vw;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      flex-direction: column;
    }

    #app header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    #app header h2 {
      margin-bottom: 10px;
      color: #222;
    }

    #userInfo {
      font-weight: 600;
      font-size: 14px;
      color: #555;
    }

    #app .btn {
      background: #304ffe;
      color: white;
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-left: 8px;
      transition: background 0.3s ease;
      user-select: none;
    }
    #app .btn:hover {
      background: #1a2ed0;
    }
    #app .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    #controls {
      margin-bottom: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    #searchInput {
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #bbb;
      flex-grow: 1;
      font-size: 16px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px 8px;
      text-align: center;
    }
    th {
      background: #304ffe;
      color: white;
    }

    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    /* Scroll horizontal para tabelas pequenas telas */
    .table-wrapper {
      overflow-x: auto;
    }
  </style>
</head>
<body>

  <!-- Tela de login -->
  <div id="loginForm">
    <h2>Entrar</h2>
    <div class="input-group">
      <label for="username">Usuário</label>
      <input type="text" id="username" placeholder="Digite seu usuário" />
    </div>
    <div class="input-group">
      <label for="password">Senha</label>
      <input type="password" id="password" placeholder="Digite sua senha" />
    </div>
    <button onclick="login()">Entrar</button>
    <p id="errorMsg" class="error-message">Usuário ou senha incorretos.</p>
  </div>

  <!-- Tela do app após login -->
  <div id="app" style="display: none; flex-direction: column;">
    <header>
      <h2>Controle de Estoque</h2>
      <div>
        <span id="userInfo"></span>
        <button class="btn" onclick="logout()">Logout</button>
      </div>
    </header>

    <div id="controls">
      <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Procurar produto..." />
      <button class="btn" onclick="addRow()">Adicionar Produto</button>
      <button class="btn" onclick="saveData()">Salvar</button>
      <button class="btn" onclick="exportToExcel()">Exportar Excel</button>
      <button class="btn" onclick="resetQuantities()">Reset Quantidades</button>
      <button class="btn" onclick="loadData()">Carregar Lista</button>
    </div>

    <div class="table-wrapper">
      <table id="estoqueTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Produto</th>
            <th>Quantidade</th>
            <th>Referência</th>
            <th>Data Última Alteração</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- Linhas serão geradas aqui -->
        </tbody>
      </table>
    </div>
  </div>

<script>
  // Usuários fixos
  const users = [
    { username: 'admin', password: 'admin123' },
    { username: 'usuario', password: 'senha123' }
  ];

  // Estado
  let currentUser = null;
  let produtos = [];

  // Login
  function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const errorMsg = document.getElementById('errorMsg');

    const user = users.find(u => u.username === username && u.password === password);
    if(user) {
      currentUser = user.username;
      errorMsg.style.display = 'none';
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      document.getElementById('userInfo').textContent = `Logado como: ${currentUser}`;
      loadData();
    } else {
      errorMsg.style.display = 'block';
    }
  }

  // Logout
  function logout() {
    currentUser = null;
    produtos = [];
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('app').style.display = 'none';
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    document.getElementById('errorMsg').style.display = 'none';
  }

  // Gerar ID único simples
  function generateId() {
    return 'id-' + Math.random().toString(36).substr(2, 9);
  }

  // Renderizar tabela
  function renderTable() {
    const tbody = document.querySelector('#estoqueTable tbody');
    tbody.innerHTML = '';

    produtos.forEach(prod => {
      const tr = document.createElement('tr');

      tr.innerHTML = `
        <td>${prod.id}</td>
        <td><input type="text" value="${prod.produto}" oninput="updateProduto('${prod.id}', this.value)" /></td>
        <td><input type="number" min="0" value="${prod.quantidade}" oninput="updateQuantidade('${prod.id}', this.value)" /></td>
        <td><input type="text" value="${prod.referencia}" oninput="updateReferencia('${prod.id}', this.value)" /></td>
        <td>${prod.dataAlteracao}</td>
        <td><button onclick="removeRow('${prod.id}')">Remover</button></td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Atualizar campos
  function updateProduto(id, val) {
    val = val.trim();
    if (!val) return; // não aceita vazio

    // Checar duplicados (ignorando o próprio id)
    if(produtos.some(p => p.produto.toLowerCase() === val.toLowerCase() && p.id !== id)) {
      alert('Produto duplicado não permitido!');
      loadData(); // revert changes visually
      return;
    }

    let prod = produtos.find(p => p.id === id);
    if(prod) {
      prod.produto = val;
      prod.dataAlteracao = new Date().toLocaleString();
      renderTable();
    }
  }
  function updateQuantidade(id, val) {
    val = Number(val);
    if (isNaN(val) || val < 0) return;
    let prod = produtos.find(p => p.id === id);
    if(prod) {
      prod.quantidade = val;
      prod.dataAlteracao = new Date().toLocaleString();
      renderTable();
    }
  }
  function updateReferencia(id, val) {
    val = val.trim();
    let prod = produtos.find(p => p.id === id);
    if(prod) {
      prod.referencia = val;
      prod.dataAlteracao = new Date().toLocaleString();
      renderTable();
    }
  }

  // Adicionar linha
  function addRow() {
    let novoId = generateId();
    // Novo produto vazio, mas produto não pode ser duplicado, então deixa vazio e obriga usuário preencher
    produtos.push({
      id: novoId,
      produto: '',
      quantidade: 0,
      referencia: '',
      dataAlteracao: new Date().toLocaleString()
    });
    renderTable();
  }

  // Remover linha
  function removeRow(id) {
    if(confirm('Deseja remover este produto?')) {
      produtos = produtos.filter(p => p.id !== id);
      renderTable();
    }
  }

  // Buscar produtos na tabela
  function searchTable() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const trs = document.querySelectorAll('#estoqueTable tbody tr');

    trs.forEach(tr => {
      const produto = tr.querySelector('td:nth-child(2) input').value.toLowerCase();
      if(produto.includes(input)) {
        tr.style.display = '';
      } else {
        tr.style.display = 'none';
      }
    });
  }

  // Salvar no localStorage
  function saveData() {
    // Valida antes de salvar
    for(let p of produtos) {
      if(!p.produto || p.produto.trim() === '') {
        alert('Todos os produtos devem ter nome preenchido!');
        return;
      }
    }
    localStorage.setItem('estoqueProdutos', JSON.stringify(produtos));
    localStorage.setItem('lastUser', currentUser);
    alert('Dados salvos com sucesso!');
  }

  // Carregar do localStorage
  function loadData() {
    let dados = localStorage.getItem('estoqueProdutos');
    if(dados) {
      produtos = JSON.parse(dados);
    } else {
      produtos = [];
    }
    renderTable();
  }

  // Resetar quantidades para zero
  function resetQuantities() {
    if(confirm('Deseja zerar todas as quantidades?')) {
      produtos.forEach(p => {
        p.quantidade = 0;
        p.dataAlteracao = new Date().toLocaleString();
      });
      renderTable();
    }
  }

  // Exportar para Excel usando SheetJS
  function exportToExcel() {
    if(produtos.length === 0) {
      alert('Não há dados para exportar.');
      return;
    }
    // Gerar array para SheetJS
    const dataToExport = produtos.map(p => ({
      ID: p.id,
      Produto: p.produto,
      Quantidade: p.quantidade,
      Referencia: p.referencia,
      'Data Última Alteração': p.dataAlteracao
    }));

    // Carregar SheetJS via CDN
    if(typeof XLSX === 'undefined') {
      const script = document.createElement('script');
      script.src = 'https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js';
      script.onload = () => gerarExcel(dataToExport);
      document.body.appendChild(script);
    } else {
      gerarExcel(dataToExport);
    }
  }

  function gerarExcel(data) {
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Estoque");
    XLSX.writeFile(wb, "estoque.xlsx");
  }

  // Auto login se tiver usuário salvo
  window.onload = function() {
    const lastUser = localStorage.getItem('lastUser');
    if(lastUser) {
      currentUser = lastUser;
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('app').style.display = 'flex';
      document.getElementById('userInfo').textContent = `Logado como: ${currentUser}`;
      loadData();
    }
  }
</script>

</body>
</html>
